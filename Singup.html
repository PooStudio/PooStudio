<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POOSTUDIO ✦ Signup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="signupcss.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">
</head>

<body>

<div id="three-container"></div>
<div id="noise"></div>
<div id="particles"></div>
<div id="starsContainer"></div>
<div class="scanlines"></div>
<div class="glitch-overlay"></div>

<div id="loading-screen">
  <div class="loading-content">
    <div class="loading-logo glitch" data-text="POOSTUDIO">POOSTUDIO</div>
    <div class="loading-title glitch" data-text="Preparing Signup">Preparing Signup</div>
    <p class="loading-text">Loading your portal to the future...</p>
    <div class="loading-bar">
      <div class="loading-progress" id="progress"></div>
    </div>
  </div>
</div>

<div class="container" id="container">
  <h1 class="glow-text">SIGN UP</h1>
  <p class="subtitle">
    Create your account to join the community.<br>
    Secure and easy access to all features.
  </p>

  <div class="signup-warning" role="alert" aria-live="polite" style="background:linear-gradient(90deg,#fff4e5,#ffd6cc); color:#111; padding:14px; border-radius:10px; margin-bottom:18px; box-shadow:0 6px 24px rgba(0,0,0,0.25);">
    <strong>Security Notice:</strong>
    <span style="display:block; margin-top:6px;">Do not use your email account password here. Use a unique, strong password for this site and do not reuse the same password across multiple sites.</span>
  </div>

  <form id="form" action="Need link!!!!!!!!" method="POST">
    <label>USERNAME</label>
    <input name="username" required minlength="3" maxlength="20" placeholder="Choose a unique username">

    <label>EMAIL</label>
    <input type="email" name="email" required placeholder="Enter your email address">

    <label>PASSWORD</label>
    <input type="password" name="password" required minlength="8" placeholder="Create a strong password">

    <label>CONFIRM PASSWORD</label>
    <input type="password" name="confirm_password" required minlength="8" placeholder="Confirm your password">

    <button id="submit">CREATE ACCOUNT</button>
  </form>
</div>

<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-brand">
      <span class="footer-logo glitch" data-text="POOSTUDIO">POOSTUDIO</span>
      <p class="footer-copy">
        © <span id="year"></span> POOSTUDIO. All rights reserved.
      </p>
    </div>

    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </div>
  </div>

  <div class="footer-particles" aria-hidden="true">
    <span></span><span></span><span></span><span></span><span></span>
  </div>
</footer>
 
<script type="module">
  // Firebase initialization and signup handler
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, updateProfile, sendEmailVerification } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD5SoqDcAYtY9fyQ8Udwu0bQUGbKLL3-5M",
    authDomain: "laggyworld-be6e4.firebaseapp.com",
    projectId: "laggyworld-be6e4",
    storageBucket: "laggyworld-be6e4.firebasestorage.app",
    messagingSenderId: "198058418554",
    appId: "1:198058418554:web:be7c968e8181b87243f6c3"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Local utilities for reuse prevention (same storage key used earlier)
  async function hashPassword(pw) {
    const enc = new TextEncoder();
    const data = enc.encode(pw);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  function getStoredHashes() {
    try {
      const raw = localStorage.getItem('poostudio_password_hashes');
      return raw ? JSON.parse(raw) : [];
    } catch (e) {
      return [];
    }
  }

  function saveHash(hash) {
    const arr = getStoredHashes();
    arr.unshift(hash);
    if (arr.length > 10) arr.length = 10; // keep last 10
    localStorage.setItem('poostudio_password_hashes', JSON.stringify(arr));
  }

  // Signup flow using Firebase Auth
  const formEl = document.getElementById('form');
  if (formEl) {
    formEl.addEventListener('submit', async (ev) => {
      ev.preventDefault();

      const username = formEl.querySelector('input[name="username"]').value.trim();
      const email = formEl.querySelector('input[name="email"]').value.trim();
      const password = formEl.querySelector('input[name="password"]').value;
      const confirm = formEl.querySelector('input[name="confirm_password"]').value;

      if (password !== confirm) {
        alert('Passwords do not match!');
        return;
      }

      try {
        const hash = await hashPassword(password);
        const stored = getStoredHashes();
        if (stored.includes(hash)) {
          alert('This password was used before on this site. Please choose a different, unique password.');
          return;
        }

        // Create user in Firebase
        const cred = await createUserWithEmailAndPassword(auth, email, password);

        // Update display name
        try { await updateProfile(cred.user, { displayName: username }); } catch (uErr) { console.warn('updateProfile failed', uErr); }

        // Send verification email
        try { await sendEmailVerification(cred.user); } catch (vErr) { console.warn('sendEmailVerification failed', vErr); }

        // Save hash and signup time locally
        saveHash(hash);
        localStorage.setItem('poostudio_signup_time', Date.now());

        alert('Account created. A verification email has been sent.');
        // Optionally redirect to home
        window.location.href = 'index.html';
      } catch (err) {
        console.error('Signup failed', err);
        alert('Signup failed: ' + (err && err.message ? err.message : err));
      }
    });
  }
</script>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

let p = 0;
const bar = document.getElementById("progress");
const loading = document.getElementById("loading-screen");
const container = document.getElementById("container");

const loader = setInterval(() => {
  p += Math.random() * 15;
  bar.style.width = Math.min(p,100) + "%";
  if (p >= 100) {
    clearInterval(loader);
    loading.style.display = "none";
    container.style.display = "block";
  }
}, 120);


const last = localStorage.getItem(KEY);
if (last && Date.now() - last < DAY) {
  lock(Number(last) + DAY);
}
 
async function hashPassword(pw) {
  const enc = new TextEncoder();
  const data = enc.encode(pw);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

function getStoredHashes() {
  try {
    const raw = localStorage.getItem('poostudio_password_hashes');
    return raw ? JSON.parse(raw) : [];
  } catch (e) {
    return [];
  }
}

function saveHash(hash) {
  const arr = getStoredHashes();
  arr.unshift(hash);
  if (arr.length > 10) arr.length = 10; // keep last 10
  localStorage.setItem('poostudio_password_hashes', JSON.stringify(arr));
}
// Signup is handled in the module script using Firebase Auth; no duplicate submit handler here.
</script>

</body>
</html>